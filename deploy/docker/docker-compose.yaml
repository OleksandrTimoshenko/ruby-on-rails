version: '3.8'

services:

    nginx:
      image: nginx:1.19.0-alpine
      volumes:
        - nginx-configs:/etc/nginx/conf.d/
      ports:
        - 80:80
      depends_on:
        - ruby_backend

    postgresql:
        image: postgres
        volumes:
            - postgres:/var/lib/postgresql/data/
            - backups_data:/var/backups/
        ports:
          - 5432:5432
        env_file: 
            - ../../.env

    ruby_backend:
        image: ruby_backend
        environment:
            - DBHOST=postgresql
        command: ./entrypoint.sh
        expose:
          - 3000
        depends_on:
          - postgresql
        env_file:
          - ../../.env

volumes:
    postgres:
    backups_data:
    nginx-configs:
      driver_opts:
        type: none
        device: /opt/nginx/
        o: bind
